<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yunqi.backend.mapper.UserMapper">

    <select id="selectAllocatedList" resultType="User">
        select tu.* from tb_user tu
        where tu.id in (
            select user_id from tb_user_role
            where role_id = #{roleId}
        )
        <if test="userDTO.username != null">
            and tu.username like concat('%', #{userDTO.username}, '%')
        </if>
        <if test="userDTO.nickname != null">
            and tu.nickname like concat('%', #{userDTO.nickname}, '%')
        </if>
        <if test="userDTO.phone != null">
            and tu.phone like concat('%', #{userDTO.phone}, '%')
        </if>

    </select>

    <select id="selectUnallocatedList" resultType="User">
        select tu.* from tb_user tu
        where tu.id not in (
            select user_id from tb_user_role
            group by user_id
        )
        <if test="userDTO.username != null">
            and tu.username like concat('%', #{userDTO.username}, '%')
        </if>
        <if test="userDTO.nickname != null">
            and tu.nickname like concat('%', #{userDTO.nickname}, '%')
        </if>
        <if test="userDTO.phone != null">
            and tu.phone like concat('%', #{userDTO.phone}, '%')
        </if>
    </select>
</mapper>
